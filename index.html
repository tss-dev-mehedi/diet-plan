<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Intermittent Fasting Schedule - Enhanced Tracker</title>
  <style>
    :root{
      --bg:#f7fafc; --card:#ffffff; --accent:#0ea5a6; --muted:#6b7280;
      --good:#16a34a; --warn:#f59e0b; --danger:#ef4444;
    }
    body{font-family: 'Noto Sans Bengali', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#111827; margin:0; padding:24px;}
    .container{max-width:1200px;margin:0 auto}
    h1{font-size:20px;margin:0 0 12px}
    .lead{margin:0 0 18px;color:var(--muted)}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06);margin-bottom:20px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:12px 10px;text-align:left;vertical-align:middle}
    thead th{background:linear-gradient(90deg,#0ea5a6,#06b6d4);color:white;border-radius:8px}
    tbody tr:nth-child(odd){background:#fff}
    tbody tr:nth-child(even){background:#f1f5f9}
    .time{font-weight:600;width:20%}
    .action{width:12%;text-align:center}
    .small{font-size:13px;color:var(--muted)}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:600}
    .on{background:var(--good);color:white}
    .late{background:var(--warn);color:#111827}
    .miss{background:var(--danger);color:white}
    .pending{background:#e5e7eb;color:#374151}
    .score{display:flex;align-items:center;gap:12px;margin-top:14px}
    .score .pill{padding:10px 14px;border-radius:999px;font-weight:700}
    .score .good{background:linear-gradient(90deg,#16a34a33,#16a34a);color:white}
    .score .ok{background:linear-gradient(90deg,#f59e0b33,#f59e0b);color:white}
    .score .bad{background:linear-gradient(90deg,#ef444433,#ef4444);color:white}
    .hint{margin-top:10px;font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .small-btn{background:#eef2ff;border-radius:8px;padding:8px;font-size:13px;border:1px solid #e6e9f2;cursor:pointer}
    .ticker{overflow:hidden;white-space:nowrap;border-radius:8px;background:#d1fae5;color:#065f46;padding:10px;margin-bottom:12px; font-weight:600;}
    .ticker span{display:inline-block;padding-right:50px;animation:slide 20s linear infinite;}
    @keyframes slide{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
    .history-table{font-size:12px}
    .history-table th{font-size:11px;padding:8px 6px}
    .history-table td{padding:6px 4px;text-align:center}
    .day-score{padding:4px 8px;border-radius:999px;font-weight:600;font-size:11px}
    .day-good{background:var(--good);color:white}
    .day-ok{background:var(--warn);color:white}
    .day-bad{background:var(--danger);color:white}
    .grid-layout{display:grid;grid-template-columns:2fr 1fr;gap:20px}
    @media (max-width: 768px){
      .grid-layout{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Intermittent Fasting Schedule (Enhanced Tracker) ‚Äî Checklist</h1>
  <div class="ticker" id="ticker">Motivation will scroll here...</div>
  <p class="lead">‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá‡•§ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶∞‡¶ø‡¶§‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá 'Late' ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá‡•§</p>

  <div class="grid-layout">
    <div class="card">
      <div class="controls">
        <button class="small-btn" id="todayBtn">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®</button>
        <div style="margin-left:auto;align-self:center" id="currentTime"></div>
      </div>

      <table id="scheduleTable">
        <thead>
          <tr>
            <th>‡¶∏‡¶Æ‡¶Ø‡¶º</th>
            <th>‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®</th>
            <th>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</th>
            <th class="action">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
            <th class="action">‡¶ö‡ßá‡¶ï</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="score" id="scoreBox" style="display:none">
        <div class="pill" id="scoreText"></div>
        <div class="small" id="scoreDetail"></div>
      </div>
      <div class="hint">‡¶ü‡¶ø‡¶™: ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶§‡ßã ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá '‡¶Ö‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ', ‡¶¶‡ßá‡¶∞‡¶ø‡¶§‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá 'Late' ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá‡•§</div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 12px;font-size:16px">‡¶ó‡¶§ ‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°</h3>
      <table class="history-table" id="historyTable">
        <thead>
          <tr>
            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
            <th>‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th>
            <th>‡¶Ö‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ</th>
            <th>Late</th>
            <th>Miss</th>
          </tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>

const tickerEl = document.getElementById('ticker');
const motivationLines = [
  '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ü‡¶ø ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®!',
  '‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∂‡ßÄ‡¶≤‡¶® ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡¶´‡¶≤ ‡¶ï‡¶∞‡ßá‡•§',
  '‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶õ‡ßã‡¶ü ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶á ‡¶¨‡¶°‡¶º ‡¶´‡¶≤ ‡¶Ü‡¶®‡ßá‡•§',
  '‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®, ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
  '‡¶∂‡ßÉ‡¶ô‡ßç‡¶ñ‡¶≤‡¶æ ‡¶¨‡¶ú‡¶æ‡¶Ø‡¶º ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡•§'];

function updateTicker(){
  const today = new Date();
  const index = today.getDate() % motivationLines.length;
  tickerEl.innerHTML = '<span>' + motivationLines[index] + ' ‚ú® </span>';
}
updateTicker();

const schedule = [
  {id:'sleep', time:'‡¶∞‡¶æ‡¶§ ‡ßß‡ßß:‡ß¶‡ß¶ ‚Äì ‡¶≠‡ßã‡¶∞ ‡ß´:‡ß©‡ß¶', start:'23:00', end:'05:30', title:'‡¶ò‡ßÅ‡¶Æ', detail:'‡ß¨.‡ß´‚Äì‡ß≠ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶ò‡ßÅ‡¶Æ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø‡•§', emoji:'üò¥'},
  {id:'fajr', time:'‡¶≠‡ßã‡¶∞ ‡ß´:‡ß©‡ß¶ ‚Äì ‡ß¨:‡ß¶‡ß¶', start:'05:30', end:'06:00', title:'‡¶´‡¶ú‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú', detail:'‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú + ‡¶¶‡ßã‡¶Ø‡¶º‡¶æ, ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶ö‡¶ø‡¶Ç‡•§', emoji:'üïå'},
  {id:'fast', time:'‡¶≠‡ßã‡¶∞ ‡ß¨:‡ß¶‡ß¶ ‚Äì ‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞ ‡ßß‡ß®:‡ß¶‡ß¶', start:'06:00', end:'12:00', title:'‡¶â‡¶™‡ßã‡¶∏ ‡¶∏‡¶Æ‡¶Ø‡¶º', detail:'‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶™‡¶æ‡¶®‡¶ø/‡¶≤‡ßá‡¶¨‡ßÅ ‡¶™‡¶æ‡¶®‡¶ø/‡¶ó‡ßç‡¶∞‡¶ø‡¶® ‡¶ü‡¶ø/‡¶¨‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶´‡¶ø‡•§', emoji:'üö´'},
  {id:'lunch', time:'‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞ ‡ßß‡ß®:‡ß©‡ß¶', start:'12:00', end:'13:30', title:'‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ (Lunch)', detail:'‡¶≠‡¶æ‡¶§ ‡ßß ‡¶ï‡¶æ‡¶™ + ‡¶°‡¶æ‡¶≤ + ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡¶ø‡¶® + ‡¶∏‡¶¨‡¶ú‡¶ø + ‡¶∏‡¶æ‡¶≤‡¶æ‡¶¶‡•§', emoji:'üçõ'},
  {id:'snack', time:'‡¶¨‡¶ø‡¶ï‡ßá‡¶≤ ‡ß™:‡ß¶‡ß¶', start:'15:30', end:'16:30', title:'Snack/‡¶ö‡¶æ ‡¶ü‡¶æ‡¶á‡¶Æ', detail:'‡¶ó‡ßç‡¶∞‡¶ø‡¶® ‡¶ü‡¶ø + ‡¶∏‡ßá‡¶¶‡ßç‡¶ß ‡¶°‡¶ø‡¶Æ/‡¶¨‡¶æ‡¶¶‡¶æ‡¶Æ/‡¶õ‡ßã‡¶≤‡¶æ/‡¶Æ‡ßÅ‡¶°‡¶º‡¶ø-‡¶∂‡¶∏‡¶æ‡•§', emoji:'‚òï'},
  {id:'exercise', time:'‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ ‡ß¨:‡ß©‡ß¶ ‚Äì ‡ß≠:‡ß¶‡ß¶', start:'18:30', end:'19:00', title:'‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡¶æ‡¶Æ/‡¶π‡¶æ‡¶Å‡¶ü‡¶æ', detail:'‡¶∏‡ßç‡¶ï‡ßã‡¶Ø‡¶º‡¶æ‡¶ü, ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶™‡ßÅ‡¶∂‡¶Ü‡¶™, ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶ö‡¶ø‡¶Ç ‡¶¨‡¶æ ‡ßß‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶π‡¶æ‡¶Å‡¶ü‡¶æ‡•§', emoji:'üèÉ'},
  {id:'dinner', time:'‡¶∞‡¶æ‡¶§ ‡ß≠:‡ß©‡ß¶', start:'19:00', end:'20:30', title:'‡¶∂‡ßá‡¶∑ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ (Dinner)', detail:'‡¶Ö‡¶≤‡ßç‡¶™ ‡¶≠‡¶æ‡¶§/‡¶∏‡¶¨‡¶ú‡¶ø/‡¶°‡¶æ‡¶≤/‡¶™‡ßç‡¶∞‡ßã‡¶ü‡¶ø‡¶® + ‡¶∏‡¶æ‡¶≤‡¶æ‡¶¶‡•§', emoji:'üç≤'},
  {id:'work', time:'‡¶∞‡¶æ‡¶§ ‡ßÆ:‡ß¶‡ß¶ ‚Äì ‡ßß‡ß¶:‡ß©‡ß¶', start:'20:00', end:'22:30', title:'‡¶ï‡¶æ‡¶ú/‡¶Ö‡¶¨‡¶∏‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º', detail:'‡¶™‡¶æ‡¶®‡¶ø ‡¶ñ‡¶æ‡¶¨‡ßá‡¶®, ‡¶≠‡¶æ‡¶∞‡ßÄ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶®‡¶Ø‡¶º‡•§', emoji:'üíª'},
  {id:'prep', time:'‡¶∞‡¶æ‡¶§ ‡ßß‡ß¶:‡ß©‡ß¶ ‚Äì ‡ßß‡ßß:‡ß¶‡ß¶', start:'22:30', end:'23:00', title:'‡¶ò‡ßÅ‡¶Æ‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø', detail:'‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ï‡¶Æ‡¶æ‡¶®, ‡¶™‡¶°‡¶º‡¶æ/‡¶¶‡ßã‡¶Ø‡¶º‡¶æ/‡¶Æ‡ßá‡¶°‡¶ø‡¶ü‡ßá‡¶∂‡¶®‡•§', emoji:'üåô'},
  {id:'bed', time:'‡¶∞‡¶æ‡¶§ ‡ßß‡ßß:‡ß¶‡ß¶', start:'23:00', end:'23:30', title:'‡¶∂‡¶Ø‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶Ø‡¶æ‡¶®', detail:'‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶∂‡ßá‡¶∑, ‡¶ï‡¶æ‡¶≤ ‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶¶‡ßç‡¶Ø‡¶Æ‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', emoji:'üõèÔ∏è'}
];

// Storage functions
function getTodayKey(){
  return new Date().toDateString();
}

function getTodayData(){
  const key = getTodayKey();
  const data = JSON.parse(localStorage.getItem(key) || '{}');
  return data;
}

function saveTodayData(data){
  const key = getTodayKey();
  localStorage.setItem(key, JSON.stringify(data));
}

function parseTime(timeStr){
  const [hours, minutes] = timeStr.split(':').map(Number);
  return hours * 60 + minutes;
}

function getCurrentMinutes(){
  const now = new Date();
  return now.getHours() * 60 + now.getMinutes();
}

function isWithinTimeWindow(startTime, endTime){
  const currentMinutes = getCurrentMinutes();
  const startMinutes = parseTime(startTime);
  const endMinutes = parseTime(endTime);
  
  // Handle overnight periods (like sleep)
  if(startMinutes > endMinutes){
    return currentMinutes >= startMinutes || currentMinutes <= endMinutes;
  }
  
  return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
}

function isLate(endTime){
  const currentMinutes = getCurrentMinutes();
  const endMinutes = parseTime(endTime);
  
  // For overnight periods, check if it's past the end time in the morning
  if(endTime === '05:30' && currentMinutes > endMinutes && currentMinutes < 12 * 60){
    return true;
  }
  
  return currentMinutes > endMinutes;
}

function renderSchedule() {
  const tbody = document.querySelector("#scheduleTable tbody");
  tbody.innerHTML = "";
  const todayData = getTodayData();

  schedule.forEach(item => {
    const tr = document.createElement("tr");
    const isChecked = todayData[item.id]?.checked || false;
    const checkTime = todayData[item.id]?.checkTime;

    tr.innerHTML = `
      <td class="time">${item.time}</td>
      <td>${item.emoji} ${item.title}</td>
      <td>${item.detail}</td>
      <td class="status" id="status-${item.id}"><span class="badge pending">‚è≥</span></td>
      <td><input type="checkbox" id="chk-${item.id}" ${isChecked ? 'checked' : ''}></td>
    `;

    tbody.appendChild(tr);

    // Update status based on current time and check status
    updateItemStatus(item, isChecked, checkTime);

    document.getElementById(`chk-${item.id}`).addEventListener("change", (e)=>{
      const now = new Date();
      const currentTime = now.getTime();
      
      if(e.target.checked){
        // Save check data
        const todayData = getTodayData();
        todayData[item.id] = {
          checked: true,
          checkTime: currentTime
        };
        saveTodayData(todayData);
        
        updateItemStatus(item, true, currentTime);
      } else {
        // Remove check data
        const todayData = getTodayData();
        delete todayData[item.id];
        saveTodayData(todayData);
        
        updateItemStatus(item, false, null);
      }
      checkScore();
    });
  });
}

function updateItemStatus(item, isChecked, checkTime){
  const statusEl = document.getElementById(`status-${item.id}`);
  
  if(!isChecked){
    // Check if current time is past the activity window
    if(isLate(item.end)){
      statusEl.innerHTML = '<span class="badge miss">‚ùå Miss</span>';
    } else {
      statusEl.innerHTML = '<span class="badge pending">‚è≥</span>';
    }
    return;
  }
  
  // Item is checked, determine if it was on time or late
  const checkDate = new Date(checkTime);
  const checkMinutes = checkDate.getHours() * 60 + checkDate.getMinutes();
  const endMinutes = parseTime(item.end);
  
  // For overnight activities like sleep, handle specially
  if(item.id === 'sleep'){
    statusEl.innerHTML = '<span class="badge on">‚úî ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</span>';
  } else if(checkMinutes <= endMinutes || isWithinTimeWindow(item.start, item.end)){
    statusEl.innerHTML = '<span class="badge on">‚úî ‡¶Ö‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ</span>';
  } else {
    statusEl.innerHTML = '<span class="badge late">‚è∞ Late</span>';
  }
}

function updateAllStatuses(){
  const todayData = getTodayData();
  schedule.forEach(item => {
    const isChecked = todayData[item.id]?.checked || false;
    const checkTime = todayData[item.id]?.checkTime;
    updateItemStatus(item, isChecked, checkTime);
  });
}

function checkScore(){
  const todayData = getTodayData();
  let onTime = 0, late = 0, miss = 0;
  
  schedule.forEach(item => {
    const data = todayData[item.id];
    if(!data?.checked){
      if(isLate(item.end)){
        miss++;
      }
      return;
    }
    
    const checkDate = new Date(data.checkTime);
    const checkMinutes = checkDate.getHours() * 60 + checkDate.getMinutes();
    const endMinutes = parseTime(item.end);
    
    if(item.id === 'sleep' || checkMinutes <= endMinutes || isWithinTimeWindow(item.start, item.end)){
      onTime++;
    } else {
      late++;
    }
  });
  
  const scoreBox = document.getElementById("scoreBox");
  const scoreText = document.getElementById("scoreText");
  const scoreDetail = document.getElementById("scoreDetail");
  
  if(onTime + late + miss > 0){
    scoreBox.style.display = "flex";
    const total = onTime + late + miss;
    const percentage = Math.round((onTime / schedule.length) * 100);
    
    if(percentage >= 80){
      scoreText.className = "pill good";
      scoreText.innerText = `üéâ Excellent! ${onTime}/${schedule.length} ‡¶Ö‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ`;
    } else if(percentage >= 60){
      scoreText.className = "pill ok";
      scoreText.innerText = `üëç Good! ${onTime}/${schedule.length} ‡¶Ö‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ`;
    } else {
      scoreText.className = "pill bad";
      scoreText.innerText = `üí™ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®! ${onTime}/${schedule.length} ‡¶Ö‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ`;
    }
    
    scoreDetail.innerText = `Late: ${late}, Miss: ${miss}`;
  }
}

function renderHistory(){
  const historyBody = document.getElementById('historyBody');
  historyBody.innerHTML = '';
  
  for(let i = 0; i < 7; i++){
    const date = new Date();
    date.setDate(date.getDate() - i);
    const dateKey = date.toDateString();
    const data = JSON.parse(localStorage.getItem(dateKey) || '{}');
    
    let onTime = 0, late = 0, miss = 0;
    
    schedule.forEach(item => {
      const itemData = data[item.id];
      if(!itemData?.checked){
        miss++;
        return;
      }
      
      const checkDate = new Date(itemData.checkTime);
      const checkMinutes = checkDate.getHours() * 60 + checkDate.getMinutes();
      const endMinutes = parseTime(item.end);
      
      if(item.id === 'sleep' || checkMinutes <= endMinutes){
        onTime++;
      } else {
        late++;
      }
    });
    
    const total = onTime + late + miss;
    const percentage = total > 0 ? Math.round((onTime / schedule.length) * 100) : 0;
    
    let scoreClass = 'day-bad';
    if(percentage >= 80) scoreClass = 'day-good';
    else if(percentage >= 60) scoreClass = 'day-ok';
    
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${date.toLocaleDateString('bn-BD', {day: 'numeric', month: 'short'})}</td>
      <td><span class="day-score ${scoreClass}">${percentage}%</span></td>
      <td>${onTime}</td>
      <td>${late}</td>
      <td>${miss}</td>
    `;
    historyBody.appendChild(tr);
  }
}

renderSchedule();
checkScore();
renderHistory();

// Update statuses every minute
setInterval(() => {
  updateAllStatuses();
  checkScore();
}, 60000);

document.getElementById('todayBtn').addEventListener('click', function() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('bn-BD', {hour12: false});
  const todayData = getTodayData();
  const completed = Object.keys(todayData).length;
  alert(`‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶Æ‡¶Ø‡¶º: ${timeString}\n‡¶Ü‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: ${completed}/${schedule.length}`);
});

// Update current time display
function updateCurrentTime() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('bn-BD', {hour12: false});
  document.getElementById('currentTime').textContent = timeString;
}

updateCurrentTime();
setInterval(updateCurrentTime, 1000);

</script>
</body>
</html>
